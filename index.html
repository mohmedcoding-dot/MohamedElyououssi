<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amigos - Parfumerie de Luxe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');

        :root {
            --gold: #D4AF37;
            --gold-light: #F7EF8A;
            --gold-dark: #B8860B;
            --black: #000000;
            --black-light: #1A1A1A;
            --white: #FFFFFF;
            --gray: #F5F5F5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--white);
            color: var(--black);
            overflow-x: hidden;
        }

        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        .animate-fadeIn { animation: fadeIn 0.8s ease-out; }
        .animate-slideIn { animation: slideIn 0.6s ease-out; }
        .animate-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }

        /* Styles personnalisés */
        .bg-gold { background-color: var(--gold); }
        .text-gold { color: var(--gold); }
        .border-gold { border-color: var(--gold); }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            color: var(--black);
            transition: all 0.3s ease;
        }

        .btn-gold:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4);
        }

        .card-elegant {
            background: var(--white);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: all 0.3s ease;
        }

        .card-elegant:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: white;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .notification.success { background: #10B981; }
        .notification.error { background: #EF4444; }
        .notification.info { background: #3B82F6; }
        .notification.warning { background: #F59E0B; }

        /* Badge promotion */
        .promo-badge {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .price-original {
            text-decoration: line-through;
            color: #999;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Admin Dashboard */
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
        }

        .stat-card.gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
        }

        .stat-card.green {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }

        .stat-card.purple {
            background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);
        }

        /* Navigation tabs */
        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-button.active {
            color: var(--gold);
            border-bottom-color: var(--gold);
        }

        /* Product grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        /* Order status */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending { background: #FEF3C7; color: #D97706; }
        .status-confirmed { background: #DBEAFE; color: #1D4ED8; }
        .status-shipped { background: #D1FAE5; color: #065F46; }
        .status-delivered { background: #E5E7EB; color: #374151; }
        .status-cancelled { background: #FEE2E2; color: #DC2626; }
    </style>
</head>
<body class="min-h-screen">
    <!-- Navigation -->
    <nav class="bg-black border-b border-gold sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex items-center cursor-pointer" onclick="navigateTo('home')">
                    <div class="mr-3">
                        <i class="fas fa-crown text-2xl text-gold"></i>
                    </div>
                    <span class="text-2xl font-bold text-white" style="font-family: 'Playfair Display', serif;">Amigos</span>
                </div>

                <div class="hidden md:flex space-x-8">
                    <a onclick="navigateTo('home')" class="text-white hover:text-gold cursor-pointer font-medium transition-colors">Accueil</a>
                    <a onclick="navigateTo('products')" class="text-white hover:text-gold cursor-pointer font-medium transition-colors">Collection</a>
                    <a onclick="navigateTo('promotions')" class="text-white hover:text-gold cursor-pointer font-medium transition-colors">Promotions</a>
                    <a onclick="navigateTo('about')" class="text-white hover:text-gold cursor-pointer font-medium transition-colors">Notre Histoire</a>
                </div>

                <div class="flex items-center space-x-4">
                    <div class="relative cursor-pointer" onclick="navigateTo('cart')">
                        <i class="fas fa-shopping-bag text-xl text-white hover:text-gold transition-colors"></i>
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-gold text-black text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
                    </div>

                    <button id="authBtn" onclick="handleAuthClick()" class="text-white hover:text-gold transition-colors relative">
                        <i class="fas fa-user text-xl"></i>
                    </button>

                    <button id="adminBtn" onclick="navigateTo('admin')" class="hidden text-white hover:text-gold transition-colors">
                        <i class="fas fa-crown text-xl"></i>
                    </button>

                    <div id="userMenu" class="hidden absolute top-16 right-4 bg-white rounded-lg shadow-xl border border-gold min-w-48 z-50">
                        <div class="p-4 border-b border-gray-100">
                            <p class="font-semibold text-black" id="userName">Admin</p>
                            <p class="text-sm text-gray-600" id="userEmail">admin@amigos.com</p>
                        </div>
                        <button onclick="navigateTo('profile')" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-700">
                            <i class="fas fa-user-circle mr-2"></i>Mon Profil
                        </button>
                        <button onclick="navigateTo('orders')" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-gray-700">
                            <i class="fas fa-shopping-bag mr-2"></i>Mes Commandes
                        </button>
                        <button onclick="logout()" class="w-full text-left px-4 py-2 hover:bg-gray-50 text-red-600 border-t border-gray-100">
                            <i class="fas fa-sign-out-alt mr-2"></i>Déconnexion
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation Mobile -->
    <div class="md:hidden bg-black border-b border-gold fixed bottom-0 left-0 right-0 z-40">
        <div class="flex justify-around items-center h-16">
            <button onclick="navigateTo('home')" class="text-white hover:text-gold transition-colors">
                <i class="fas fa-home text-xl"></i>
            </button>
            <button onclick="navigateTo('products')" class="text-white hover:text-gold transition-colors">
                <i class="fas fa-store text-xl"></i>
            </button>
            <button onclick="navigateTo('cart')" class="text-white hover:text-gold transition-colors relative">
                <i class="fas fa-shopping-bag text-xl"></i>
                <span id="cartCountMobile" class="absolute -top-2 -right-2 bg-gold text-black text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">0</span>
            </button>
            <button onclick="navigateTo('promotions')" class="text-white hover:text-gold transition-colors">
                <i class="fas fa-tag text-xl"></i>
            </button>
            <button onclick="handleAuthClick()" class="text-white hover:text-gold transition-colors">
                <i class="fas fa-user text-xl"></i>
            </button>
        </div>
    </div>

    <!-- Contenu Principal -->
    <div id="app" class="transition-all duration-500 pb-16 md:pb-0"></div>

    <!-- Footer -->
    <footer class="bg-black border-t border-gold text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold text-gold mb-4">Amigos</h3>
                    <p class="text-gray-400">L'excellence de la parfumerie française depuis 1985.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Navigation</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a onclick="navigateTo('home')" class="hover:text-gold cursor-pointer">Accueil</a></li>
                        <li><a onclick="navigateTo('products')" class="hover:text-gold cursor-pointer">Collection</a></li>
                        <li><a onclick="navigateTo('promotions')" class="hover:text-gold cursor-pointer">Promotions</a></li>
                        <li><a onclick="navigateTo('about')" class="hover:text-gold cursor-pointer">Notre Histoire</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Service Client</h4>
                    <ul class="space-y-2 text-gray-400">
                        <li><a class="hover:text-gold cursor-pointer">Contact</a></li>
                        <li><a class="hover:text-gold cursor-pointer">Livraison</a></li>
                        <li><a class="hover:text-gold cursor-pointer">Retours</a></li>
                        <li><a class="hover:text-gold cursor-pointer">FAQ</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <div class="space-y-2 text-gray-400">
                        <p><i class="fas fa-phone mr-2"></i>+33 1 45 67 89 10</p>
                        <p><i class="fas fa-envelope mr-2"></i>contact@amigos.fr</p>
                        <p><i class="fas fa-map-marker-alt mr-2"></i>123 Avenue Montaigne, 75008 Paris</p>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
                <p>© 2024 Amigos Parfumerie. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <!-- Modal de Connexion -->
    <div id="loginModal" class="modal">
        <div class="modal-content w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-black">Connexion</h3>
                <button onclick="closeModal('loginModal')" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-gray-700 mb-2">Email</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" value="admin@amigos.com">
                </div>
                <div>
                    <label class="block text-gray-700 mb-2">Mot de passe</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" value="admin123">
                </div>
                <button type="submit" class="btn-gold w-full py-3 rounded-lg font-semibold flex items-center justify-center">
                    <span id="loginText">Se connecter</span>
                    <div id="loginSpinner" class="loading ml-2 hidden"></div>
                </button>
            </form>
            <div class="mt-4 text-center text-sm text-gray-600">
                <p>Compte de démonstration : admin@amigos.com / admin123</p>
            </div>
        </div>
    </div>

    <!-- Modal Édition Produit -->
    <div id="editProductModal" class="modal">
        <div class="modal-content w-full max-w-4xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-black" id="editProductTitle">Modifier le Produit</h3>
                <button onclick="closeModal('editProductModal')" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="updateProduct(event)" class="space-y-6">
                <input type="hidden" id="editProductId">
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Informations de base -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-black border-b pb-2">Informations Produit</h4>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Nom du produit *</label>
                            <input type="text" id="editProductName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Description *</label>
                            <textarea id="editProductDescription" required rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent"></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Catégorie *</label>
                                <select id="editProductCategory" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                                    <option value="homme">Homme</option>
                                    <option value="femme">Femme</option>
                                    <option value="mixte">Mixte</option>
                                    <option value="niche">Niche</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Stock *</label>
                                <input type="number" id="editProductStock" required min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                            </div>
                        </div>
                    </div>

                    <!-- Prix et Promotion -->
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-black border-b pb-2">Prix et Promotion</h4>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Prix original (€) *</label>
                            <input type="number" id="editProductPrice" required step="0.01" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Réduction (%)</label>
                                <input type="number" id="editProductDiscount" min="0" max="100" step="5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" placeholder="0">
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Prix promo (€)</label>
                                <input type="number" id="editProductSalePrice" step="0.01" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            </div>
                        </div>

                        <div>
                            <label class="block text-gray-700 mb-2">Image URL *</label>
                            <input type="url" id="editProductImage" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                            <div class="mt-2">
                                <img id="editProductImagePreview" src="" alt="Aperçu" class="w-32 h-32 object-cover rounded-lg border hidden">
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="editProductFeatured" class="w-4 h-4 text-gold rounded focus:ring-gold">
                                <span class="ml-2 text-gray-700">Produit vedette</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="editProductActive" class="w-4 h-4 text-gold rounded focus:ring-gold" checked>
                                <span class="ml-2 text-gray-700">Produit actif</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex gap-4 pt-4 border-t">
                    <button type="submit" class="btn-gold flex-1 py-3 rounded-lg font-semibold flex items-center justify-center">
                        <i class="fas fa-save mr-2"></i>Enregistrer les modifications
                    </button>
                    <button type="button" onclick="closeModal('editProductModal')" class="border border-gold text-gold flex-1 py-3 rounded-lg font-semibold hover:bg-gold hover:text-black transition-colors">
                        Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Ajout Produit -->
    <div id="addProductModal" class="modal">
        <div class="modal-content w-full max-w-4xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-black">Nouveau Produit</h3>
                <button onclick="closeModal('addProductModal')" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <form onsubmit="addNewProduct(event)" class="space-y-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-black border-b pb-2">Informations Produit</h4>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Nom du produit *</label>
                            <input type="text" id="productName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" placeholder="Ex: Noir Absolu">
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Description *</label>
                            <textarea id="productDescription" required rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" placeholder="Description détaillée du parfum..."></textarea>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 mb-2">Catégorie *</label>
                                <select id="productCategory" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent">
                                    <option value="homme">Homme</option>
                                    <option value="femme">Femme</option>
                                    <option value="mixte">Mixte</option>
                                    <option value="niche">Niche</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 mb-2">Stock initial *</label>
                                <input type="number" id="productStock" required min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" value="10">
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h4 class="text-lg font-semibold text-black border-b pb-2">Prix et Image</h4>
                        
                        <div>
                            <label class="block text-gray-700 mb-2">Prix (€) *</label>
                            <input type="number" id="productPrice" required step="0.01" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" placeholder="99.99">
                        </div>

                        <div>
                            <label class="block text-gray-700 mb-2">Image URL *</label>
                            <input type="url" id="productImage" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold focus:border-transparent" placeholder="https://example.com/image.jpg">
                            <p class="text-sm text-gray-500 mt-1">URL d'une image représentative du produit</p>
                        </div>

                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" id="productFeatured" class="w-4 h-4 text-gold rounded focus:ring-gold">
                                <span class="ml-2 text-gray-700">Produit vedette</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="flex gap-4 pt-4 border-t">
                    <button type="submit" class="btn-gold flex-1 py-3 rounded-lg font-semibold">
                        <i class="fas fa-plus mr-2"></i>Créer le produit
                    </button>
                    <button type="button" onclick="closeModal('addProductModal')" class="border border-gold text-gold flex-1 py-3 rounded-lg font-semibold hover:bg-gold hover:text-black transition-colors">
                        Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Détails Commande -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content w-full max-w-4xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-black">Détails de la Commande</h3>
                <button onclick="closeModal('orderDetailsModal')" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="orderDetailsContent">
                <!-- Contenu chargé dynamiquement -->
            </div>
        </div>
    </div>

    <script>
        // État de l'application
        let currentUser = null;
        let cart = [];
        let products = [];
        let orders = [];
        let currentAdminTab = 'products';

        // Initialisation
        function initializeApp() {
            loadFromLocalStorage();
            updateCartCount();
            updateAuthUI();
            navigateTo('home');
            setupEventListeners();
        }

        function loadFromLocalStorage() {
            const savedProducts = localStorage.getItem('amigos_products');
            const savedUsers = localStorage.getItem('amigos_users');
            const savedCart = localStorage.getItem('amigos_cart');
            const savedCurrentUser = localStorage.getItem('amigos_currentUser');
            const savedOrders = localStorage.getItem('amigos_orders');

            // Produits
            if (!savedProducts) {
                products = [
                    {
                        id: 1,
                        name: "Noir Absolu",
                        price: 189.99,
                        description: "Un parfum masculin intense aux notes de cuir et de bois précieux. Création exclusive signature Amigos qui évoque la force et l'élégance. Parfait pour les occasions spéciales.",
                        category: "homme",
                        image: "https://images.unsplash.com/photo-1595425970377-c9703cf48b6d?w=500",
                        stock: 8,
                        featured: true,
                        discount: 0,
                        salePrice: null,
                        active: true,
                        createdAt: new Date('2024-01-15').toISOString()
                    },
                    {
                        id: 2,
                        name: "Or Impérial",
                        price: 229.99,
                        description: "Fragrance féminine royale aux accents de rose et d'ambre. L'essence du luxe français dans un flacon cristallin. Notes de tête: bergamote, mandarine. Notes de cœur: rose, jasmin. Notes de fond: ambre, vanille.",
                        category: "femme",
                        image: "https://images.unsplash.com/photo-1541643600914-78b084683601?w=500",
                        stock: 12,
                        featured: true,
                        discount: 20,
                        salePrice: 183.99,
                        active: true,
                        createdAt: new Date('2024-02-01').toISOString()
                    },
                    {
                        id: 3,
                        name: "Élégance Nocturne",
                        price: 159.99,
                        description: "Parfum unisexe mystérieux aux notes d'encens et de vanille. Pour les soirées mémorables. Développe une aura envoûtante qui ne laisse personne indifférent.",
                        category: "mixte",
                        image: "https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=500",
                        stock: 15,
                        featured: false,
                        discount: 0,
                        salePrice: null,
                        active: true,
                        createdAt: new Date('2024-01-20').toISOString()
                    },
                    {
                        id: 4,
                        name: "Bois Précieux",
                        price: 199.99,
                        description: "Essence rare de santal et de vétiver. Un parfum niche pour les connaisseurs. Limited edition 2024.",
                        category: "niche",
                        image: "https://images.unsplash.com/photo-1615634260167-0462d34c229d?w=500",
                        stock: 5,
                        featured: true,
                        discount: 15,
                        salePrice: 169.99,
                        active: true,
                        createdAt: new Date('2024-03-01').toISOString()
                    }
                ];
                localStorage.setItem('amigos_products', JSON.stringify(products));
            } else {
                products = JSON.parse(savedProducts);
            }

            // Utilisateurs
            if (!savedUsers) {
                const users = [
                    { 
                        id: 1, 
                        email: 'admin@amigos.com', 
                        password: 'admin123', 
                        role: 'admin', 
                        name: 'Administrateur Amigos',
                        phone: '+33 1 45 67 89 10',
                        address: '123 Avenue Montaigne, 75008 Paris',
                        joinedAt: new Date('2024-01-01').toISOString()
                    },
                    { 
                        id: 2, 
                        email: 'client@demo.com', 
                        password: 'client123', 
                        role: 'client', 
                        name: 'Jean Dupont',
                        phone: '+33 6 12 34 56 78',
                        address: '45 Rue de Rivoli, 75004 Paris',
                        joinedAt: new Date('2024-02-15').toISOString()
                    }
                ];
                localStorage.setItem('amigos_users', JSON.stringify(users));
            }

            // Commandes
            if (!savedOrders) {
                orders = [
                    {
                        id: 1001,
                        userId: 2,
                        items: [
                            { productId: 2, quantity: 1, price: 183.99 },
                            { productId: 3, quantity: 1, price: 159.99 }
                        ],
                        total: 343.98,
                        status: 'delivered',
                        shippingAddress: '45 Rue de Rivoli, 75004 Paris',
                        createdAt: new Date('2024-02-20').toISOString(),
                        deliveredAt: new Date('2024-02-23').toISOString()
                    },
                    {
                        id: 1002,
                        userId: 2,
                        items: [
                            { productId: 1, quantity: 1, price: 189.99 }
                        ],
                        total: 189.99,
                        status: 'confirmed',
                        shippingAddress: '45 Rue de Rivoli, 75004 Paris',
                        createdAt: new Date('2024-03-01').toISOString()
                    }
                ];
                localStorage.setItem('amigos_orders', JSON.stringify(orders));
            } else {
                orders = JSON.parse(savedOrders);
            }

            if (savedCurrentUser) currentUser = JSON.parse(savedCurrentUser);
            if (savedCart) cart = JSON.parse(savedCart);
        }

        function setupEventListeners() {
            // Calcul automatique du prix promo
            document.getElementById('editProductDiscount')?.addEventListener('input', calculateSalePrice);
            document.getElementById('editProductPrice')?.addEventListener('input', calculateSalePrice);
            
            // Preview d'image
            document.getElementById('editProductImage')?.addEventListener('input', updateImagePreview);
            document.getElementById('productImage')?.addEventListener('input', updateImagePreview);
        }

        // Navigation
        function navigateTo(page) {
            const app = document.getElementById('app');
            app.style.opacity = '0';

            setTimeout(() => {
                switch(page) {
                    case 'home':
                        renderHomePage();
                        break;
                    case 'products':
                        renderProductsPage();
                        break;
                    case 'promotions':
                        renderPromotionsPage();
                        break;
                    case 'about':
                        renderAboutPage();
                        break;
                    case 'login':
                        showModal('loginModal');
                        break;
                    case 'admin':
                        renderAdminPage();
                        break;
                    case 'cart':
                        renderCartPage();
                        break;
                    case 'profile':
                        renderProfilePage();
                        break;
                    case 'orders':
                        renderOrdersPage();
                        break;
                    default:
                        renderHomePage();
                }
                app.style.opacity = '1';
            }, 300);
        }

        // Page d'accueil
        function renderHomePage() {
            const featuredProducts = products.filter(p => p.featured && p.active);
            const newProducts = products.filter(p => p.active)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 3);

            const app = document.getElementById('app');
            app.innerHTML = `
                <!-- Hero Section -->
                <div class="bg-black text-white relative overflow-hidden">
                    <div class="absolute inset-0 bg-gradient-to-r from-black to-transparent z-10"></div>
                    <img src="https://images.unsplash.com/photo-1547887537-6158d64c35b3?w=1200" alt="Parfumerie Amigos" class="w-full h-96 object-cover opacity-60">
                    <div class="absolute inset-0 z-20 flex items-center">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                            <h1 class="text-6xl md:text-8xl font-bold mb-6 text-gold animate-fadeIn">Amigos</h1>
                            <p class="text-2xl text-gray-300 mb-8 animate-fadeIn">L'art de la parfumerie française depuis 1985</p>
                            <button onclick="navigateTo('products')" class="btn-gold px-12 py-4 rounded-lg font-bold text-lg animate-fadeIn">
                                DÉCOUVRIR LA COLLECTION
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Produits Vedettes -->
                <div class="py-20 bg-gray-50">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-4xl font-bold text-center mb-4 text-black">Nos Créations Exclusives</h2>
                        <p class="text-xl text-gray-600 text-center mb-12">Des fragrances uniques créées par nos maîtres parfumeurs</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            ${featuredProducts.slice(0, 3).map(product => `
                                <div class="card-elegant rounded-2xl p-6 group cursor-pointer" onclick="navigateTo('products')">
                                    <div class="h-64 overflow-hidden rounded-lg mb-4 relative">
                                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                                        ${product.discount > 0 ? `
                                            <div class="absolute top-4 right-4 promo-badge px-3 py-1 rounded-full text-sm font-bold">
                                                -${product.discount}%
                                            </div>
                                        ` : ''}
                                        ${product.stock < 5 ? `
                                            <div class="absolute top-4 left-4 bg-red-500 text-white px-2 py-1 rounded text-xs font-bold">
                                                Bientôt épuisé
                                            </div>
                                        ` : ''}
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2 text-black">${product.name}</h3>
                                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                                    <div class="flex items-center justify-between">
                                        ${product.discount > 0 ? `
                                            <div>
                                                <span class="text-lg text-gray-500 line-through">${product.price}€</span>
                                                <span class="text-2xl font-bold text-gold ml-2">${product.salePrice}€</span>
                                            </div>
                                            <span class="promo-badge px-3 py-1 rounded-full text-sm font-bold">-${product.discount}%</span>
                                        ` : `
                                            <span class="text-2xl font-bold text-gold">${product.price}€</span>
                                        `}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Nouveautés -->
                <div class="py-20">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h2 class="text-4xl font-bold text-center mb-4 text-black">Nouveautés</h2>
                        <p class="text-xl text-gray-600 text-center mb-12">Découvrez nos dernières créations</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            ${newProducts.map(product => `
                                <div class="card-elegant rounded-2xl p-6">
                                    <div class="h-64 overflow-hidden rounded-lg mb-4 relative">
                                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                                        <div class="absolute top-4 left-4 bg-blue-500 text-white px-2 py-1 rounded text-xs font-bold">
                                            Nouveau
                                        </div>
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2 text-black">${product.name}</h3>
                                    <p class="text-gray-600 text-sm mb-4">${product.description.substring(0, 100)}...</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-2xl font-bold text-gold">${getProductPrice(product)}€</span>
                                        <button onclick="addToCart(${product.id})" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors">
                                            Ajouter au panier
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>

                <!-- Valeurs -->
                <div class="py-20 bg-black text-white">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                        <h2 class="text-4xl font-bold mb-12 text-gold">L'Excellence Amigos</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div class="p-6">
                                <i class="fas fa-gem text-4xl text-gold mb-4"></i>
                                <h3 class="text-xl font-semibold mb-2">Qualité Exceptionnelle</h3>
                                <p class="text-gray-400">Des matières premières rares et une fabrication artisanale</p>
                            </div>
                            <div class="p-6">
                                <i class="fas fa-leaf text-4xl text-gold mb-4"></i>
                                <h3 class="text-xl font-semibold mb-2">Naturel & Durable</h3>
                                <p class="text-gray-400">Engagés dans une parfumerie responsable et éthique</p>
                            </div>
                            <div class="p-6">
                                <i class="fas fa-star text-4xl text-gold mb-4"></i>
                                <h3 class="text-xl font-semibold mb-2">Savoir-Faire Français</h3>
                                <p class="text-gray-400">Héritage et innovation depuis plus de 35 ans</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Page produits
        function renderProductsPage() {
            const activeProducts = products.filter(p => p.active);
            const categories = [...new Set(activeProducts.map(p => p.category))];
            
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="py-12">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                            <div>
                                <h1 class="text-4xl font-bold text-black">Notre Collection</h1>
                                <p class="text-gray-600 mt-2">Découvrez nos fragrances exclusives</p>
                            </div>
                            <div class="mt-4 md:mt-0 flex space-x-4">
                                <select id="categoryFilter" onchange="filterProducts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold">
                                    <option value="all">Toutes les catégories</option>
                                    ${categories.map(cat => `
                                        <option value="${cat}">${cat.charAt(0).toUpperCase() + cat.slice(1)}</option>
                                    `).join('')}
                                </select>
                                <select id="sortFilter" onchange="sortProducts()" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gold">
                                    <option value="name">Trier par nom</option>
                                    <option value="price-asc">Prix croissant</option>
                                    <option value="price-desc">Prix décroissant</option>
                                    <option value="newest">Plus récent</option>
                                </select>
                            </div>
                        </div>

                        <div id="productsGrid" class="product-grid">
                            ${activeProducts.map(product => `
                                <div class="card-elegant rounded-2xl p-6" data-category="${product.category}">
                                    <div class="h-64 overflow-hidden rounded-lg mb-4 relative">
                                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                                        ${product.discount > 0 ? `
                                            <div class="absolute top-4 right-4 promo-badge px-3 py-1 rounded-full text-sm font-bold">
                                                -${product.discount}%
                                            </div>
                                        ` : ''}
                                        ${product.stock === 0 ? `
                                            <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                                                <span class="text-white font-bold text-lg">Rupture de stock</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                    <h3 class="text-xl font-semibold mb-2 text-black">${product.name}</h3>
                                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">${product.description}</p>
                                    <div class="flex justify-between items-center">
                                        ${product.discount > 0 ? `
                                            <div>
                                                <span class="text-lg text-gray-500 line-through">${product.price}€</span>
                                                <span class="text-2xl font-bold text-gold ml-2">${product.salePrice}€</span>
                                            </div>
                                        ` : `
                                            <span class="text-2xl font-bold text-gold">${product.price}€</span>
                                        `}
                                        <button onclick="addToCart(${product.id})" 
                                                ${product.stock === 0 ? 'disabled' : ''}
                                                class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                                            ${product.stock === 0 ? 'Rupture' : 'Ajouter'}
                                        </button>
                                    </div>
                                    ${product.stock > 0 && product.stock < 10 ? `
                                        <div class="mt-2 text-xs text-orange-600">
                                            Plus que ${product.stock} unité(s) disponible(s)
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>

                        ${activeProducts.length === 0 ? `
                            <div class="text-center py-12">
                                <i class="fas fa-search text-6xl text-gray-300 mb-4"></i>
                                <h3 class="text-2xl font-semibold text-gray-600">Aucun produit trouvé</h3>
                                <p class="text-gray-500 mt-2">Essayez de modifier vos critères de recherche</p>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // Page promotions
        function renderPromotionsPage() {
            const promoProducts = products.filter(p => p.discount > 0 && p.active);
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="py-12">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-12">
                            <h1 class="text-4xl font-bold text-black mb-4">Promotions Exceptionnelles</h1>
                            <p class="text-xl text-gray-600">Profitez de nos offres spéciales limitées dans le temps</p>
                        </div>

                        ${promoProducts.length === 0 ? `
                            <div class="text-center py-12">
                                <i class="fas fa-tag text-6xl text-gray-300 mb-4"></i>
                                <h3 class="text-2xl font-semibold text-gray-600">Aucune promotion en ce moment</h3>
                                <p class="text-gray-500 mt-2">Revenez bientôt pour découvrir nos offres spéciales</p>
                                <button onclick="navigateTo('products')" class="btn-gold px-6 py-3 rounded-lg mt-4">
                                    Voir tous les produits
                                </button>
                            </div>
                        ` : `
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                ${promoProducts.map(product => `
                                    <div class="card-elegant rounded-2xl p-6 relative">
                                        <div class="h-64 overflow-hidden rounded-lg mb-4">
                                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                                            <div class="absolute top-4 right-4 promo-badge px-3 py-1 rounded-full text-sm font-bold">
                                                -${product.discount}%
                                            </div>
                                        </div>
                                        <h3 class="text-xl font-semibold mb-2 text-black">${product.name}</h3>
                                        <p class="text-gray-600 text-sm mb-4">${product.description}</p>
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <span class="text-lg text-gray-500 line-through">${product.price}€</span>
                                                <span class="text-2xl font-bold text-gold ml-2">${product.salePrice}€</span>
                                            </div>
                                            <button onclick="addToCart(${product.id})" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800">
                                                Ajouter
                                            </button>
                                        </div>
                                        <div class="mt-2 text-xs text-green-600 font-semibold">
                                            Économisez ${(product.price - product.salePrice).toFixed(2)}€
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Page Notre Histoire
        function renderAboutPage() {
            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="py-12">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-12">
                            <h1 class="text-4xl font-bold text-black mb-6">Notre Histoire</h1>
                            <div class="w-24 h-1 bg-gold mx-auto"></div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center mb-12">
                            <div>
                                <h2 class="text-3xl font-bold text-black mb-6">L'Héritage Amigos</h2>
                                <p class="text-gray-600 mb-4">
                                    Fondée en 1985 par la famille Moreau, Amigos incarne l'excellence de la parfumerie française. 
                                    Notre maison puise son inspiration dans les riches traditions de Grasse, berceau mondial du parfum.
                                </p>
                                <p class="text-gray-600 mb-4">
                                    Depuis trois générations, nous perpétuons un savoir-faire unique, alliant innovation et respect 
                                    des méthodes ancestrales. Chaque fragrance Amigos raconte une histoire, évoque une émotion, 
                                    capture un moment précieux.
                                </p>
                                <p class="text-gray-600">
                                    Aujourd'hui dirigée par Sophie Moreau, petite-fille du fondateur, Amigos continue de créer 
                                    des parfums d'exception qui traversent le temps tout en s'engageant pour une parfumerie 
                                    durable et responsable.
                                </p>
                            </div>
                            <div class="relative">
                                <img src="https://images.unsplash.com/photo-1585386959984-a4155224a1ad?w=600" 
                                     alt="Atelier Amigos" 
                                     class="rounded-2xl shadow-2xl">
                                <div class="absolute -bottom-6 -left-6 bg-gold text-black p-6 rounded-2xl shadow-xl">
                                    <p class="text-2xl font-bold">35+</p>
                                    <p class="text-sm">Ans d'expertise</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 rounded-2xl p-8 mb-12">
                            <h3 class="text-2xl font-bold text-black mb-6 text-center">Nos Valeurs</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="text-center p-6">
                                    <i class="fas fa-hand-holding-heart text-3xl text-gold mb-4"></i>
                                    <h4 class="font-semibold text-black mb-2">Qualité Exceptionnelle</h4>
                                    <p class="text-gray-600 text-sm">Des matières premières rigoureusement sélectionnées</p>
                                </div>
                                <div class="text-center p-6">
                                    <i class="fas fa-recycle text-3xl text-gold mb-4"></i>
                                    <h4 class="font-semibold text-black mb-2">Durabilité</h4>
                                    <p class="text-gray-600 text-sm">Engagés dans une démarche éco-responsable</p>
                                </div>
                                <div class="text-center p-6">
                                    <i class="fas fa-chess-queen text-3xl text-gold mb-4"></i>
                                    <h4 class="font-semibold text-black mb-2">Savoir-Faire</h4>
                                    <p class="text-gray-600 text-sm">Un héritage artisanal préservé</p>
                                </div>
                            </div>
                        </div>

                        <div class="text-center">
                            <h3 class="text-2xl font-bold text-black mb-6">Visitez Notre Boutique</h3>
                            <p class="text-gray-600 mb-6">
                                123 Avenue Montaigne, 75008 Paris<br>
                                Du lundi au samedi, 10h - 19h
                            </p>
                            <button class="btn-gold px-8 py-3 rounded-lg font-semibold">
                                <i class="fas fa-map-marker-alt mr-2"></i>Nous trouver
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Page admin
        function renderAdminPage() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('Accès réservé aux administrateurs', 'error');
                navigateTo('login');
                return;
            }

            const totalProducts = products.length;
            const totalOrders = orders.length;
            const totalRevenue = orders.reduce((sum, order) => sum + order.total, 0);
            const lowStockProducts = products.filter(p => p.stock < 5).length;

            const app = document.getElementById('app');
            app.innerHTML = `
                <div class="py-8">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <!-- En-tête -->
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-black">Administration Amigos</h1>
                            <p class="text-gray-600">Gestion complète de votre parfumerie</p>
                        </div>

                        <!-- Statistiques -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="stat-card gold">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-2xl font-bold">${totalProducts}</p>
                                        <p class="text-sm opacity-90">Produits</p>
                                    </div>
                                    <i class="fas fa-cubes text-2xl opacity-80"></i>
                                </div>
                            </div>
                            <div class="stat-card green">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-2xl font-bold">${totalOrders}</p>
                                        <p class="text-sm opacity-90">Commandes</p>
                                    </div>
                                    <i class="fas fa-shopping-bag text-2xl opacity-80"></i>
                                </div>
                            </div>
                            <div class="stat-card purple">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-2xl font-bold">${totalRevenue.toFixed(2)}€</p>
                                        <p class="text-sm opacity-90">Chiffre d'affaires</p>
                                    </div>
                                    <i class="fas fa-euro-sign text-2xl opacity-80"></i>
                                </div>
                            </div>
                            <div class="stat-card" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-2xl font-bold">${lowStockProducts}</p>
                                        <p class="text-sm opacity-90">Stock faible</p>
                                    </div>
                                    <i class="fas fa-exclamation-triangle text-2xl opacity-80"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation des onglets -->
                        <div class="border-b border-gray-200 mb-6">
                            <div class="flex space-x-8">
                                <button class="tab-button ${currentAdminTab === 'products' ? 'active' : ''}" 
                                        onclick="switchAdminTab('products')">
                                    <i class="fas fa-cubes mr-2"></i>Produits
                                </button>
                                <button class="tab-button ${currentAdminTab === 'orders' ? 'active' : ''}" 
                                        onclick="switchAdminTab('orders')">
                                    <i class="fas fa-shopping-bag mr-2"></i>Commandes
                                </button>
                                <button class="tab-button ${currentAdminTab === 'analytics' ? 'active' : ''}" 
                                        onclick="switchAdminTab('analytics')">
                                    <i class="fas fa-chart-bar mr-2"></i>Analytics
                                </button>
                                <button class="tab-button ${currentAdminTab === 'users' ? 'active' : ''}" 
                                        onclick="switchAdminTab('users')">
                                    <i class="fas fa-users mr-2"></i>Utilisateurs
                                </button>
                            </div>
                        </div>

                        <!-- Contenu des onglets -->
                        <div id="adminTabContent">
                            ${renderAdminTabContent()}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminTabContent() {
            switch(currentAdminTab) {
                case 'products':
                    return renderAdminProducts();
                case 'orders':
                    return renderAdminOrders();
                case 'analytics':
                    return renderAdminAnalytics();
                case 'users':
                    return renderAdminUsers();
                default:
                    return renderAdminProducts();
            }
        }

        function renderAdminProducts() {
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-bold text-black">Gestion des Produits</h2>
                        <button onclick="showModal('addProductModal')" class="btn-gold px-6 py-3 rounded-lg font-semibold">
                            <i class="fas fa-plus mr-2"></i>Nouveau Produit
                        </button>
                    </div>

                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-700">Produit</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Prix</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Promo</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Stock</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Statut</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${products.map(product => `
                                        <tr class="hover:bg-gray-50 ${!product.active ? 'opacity-50' : ''}">
                                            <td class="px-6 py-4">
                                                <div class="flex items-center">
                                                    <img src="${product.image}" alt="${product.name}" class="w-12 h-12 rounded object-cover mr-4">
                                                    <div>
                                                        <div class="font-semibold text-black">${product.name}</div>
                                                        <div class="text-gray-600 text-sm">${product.category}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="px-6 py-4">
                                                ${product.discount > 0 ? `
                                                    <div>
                                                        <span class="text-gray-500 line-through text-sm">${product.price}€</span>
                                                        <span class="text-gold font-semibold ml-2">${product.salePrice}€</span>
                                                    </div>
                                                ` : `
                                                    <span class="text-gold font-semibold">${product.price}€</span>
                                                `}
                                            </td>
                                            <td class="px-6 py-4">
                                                ${product.discount > 0 ? 
                                                    `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm font-semibold">-${product.discount}%</span>` : 
                                                    '<span class="text-gray-500">-</span>'
                                                }
                                            </td>
                                            <td class="px-6 py-4">
                                                <span class="px-2 py-1 rounded-full text-xs ${
                                                    product.stock > 10 ? 'bg-green-100 text-green-800' :
                                                    product.stock > 0 ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-red-100 text-red-800'
                                                }">
                                                    ${product.stock} unités
                                                </span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <span class="px-2 py-1 rounded-full text-xs ${
                                                    product.active ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                                                }">
                                                    ${product.active ? 'Actif' : 'Inactif'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4">
                                                <div class="flex space-x-2">
                                                    <button onclick="editProduct(${product.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                                                        <i class="fas fa-edit mr-1"></i>Modifier
                                                    </button>
                                                    <button onclick="toggleProductStatus(${product.id})" class="text-orange-600 hover:text-orange-800 text-sm">
                                                        <i class="fas fa-power-off mr-1"></i>${product.active ? 'Désactiver' : 'Activer'}
                                                    </button>
                                                    <button onclick="deleteProduct(${product.id})" class="text-red-600 hover:text-red-800 text-sm">
                                                        <i class="fas fa-trash mr-1"></i>Supprimer
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminOrders() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-black">Gestion des Commandes</h2>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-700">Commande</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Client</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Montant</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Statut</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Date</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${orders.map(order => {
                                        const user = JSON.parse(localStorage.getItem('amigos_users')).find(u => u.id === order.userId);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4 font-semibold text-black">#${order.id}</td>
                                                <td class="px-6 py-4">
                                                    <div>${user?.name || 'Client'}</div>
                                                    <div class="text-gray-600 text-sm">${user?.email || ''}</div>
                                                </td>
                                                <td class="px-6 py-4 font-semibold text-gold">${order.total}€</td>
                                                <td class="px-6 py-4">
                                                    <span class="status-badge status-${order.status}">
                                                        ${getOrderStatusText(order.status)}
                                                    </span>
                                                </td>
                                                <td class="px-6 py-4 text-gray-600">
                                                    ${new Date(order.createdAt).toLocaleDateString('fr-FR')}
                                                </td>
                                                <td class="px-6 py-4">
                                                    <button onclick="viewOrderDetails(${order.id})" class="text-blue-600 hover:text-blue-800 text-sm">
                                                        <i class="fas fa-eye mr-1"></i>Détails
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminAnalytics() {
            const monthlyRevenue = calculateMonthlyRevenue();
            const topProducts = getTopProducts();
            
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-black">Analytics & Rapports</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Revenus mensuels -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Revenus Mensuels</h3>
                            <div class="space-y-3">
                                ${monthlyRevenue.map(month => `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">${month.month}</span>
                                        <span class="font-semibold text-gold">${month.revenue}€</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>

                        <!-- Produits populaires -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold mb-4">Produits Populaires</h3>
                            <div class="space-y-3">
                                ${topProducts.slice(0, 5).map(product => `
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">${product.name}</span>
                                        <span class="font-semibold text-gold">${product.sales} ventes</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- Statistiques détaillées -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">Statistiques Globales</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 border rounded-lg">
                                <div class="text-2xl font-bold text-gold">${products.length}</div>
                                <div class="text-gray-600 text-sm">Produits</div>
                            </div>
                            <div class="text-center p-4 border rounded-lg">
                                <div class="text-2xl font-bold text-gold">${orders.length}</div>
                                <div class="text-gray-600 text-sm">Commandes</div>
                            </div>
                            <div class="text-center p-4 border rounded-lg">
                                <div class="text-2xl font-bold text-gold">${calculateTotalSales()}</div>
                                <div class="text-gray-600 text-sm">Ventes totales</div>
                            </div>
                            <div class="text-center p-4 border rounded-lg">
                                <div class="text-2xl font-bold text-gold">${calculateAverageOrderValue()}€</div>
                                <div class="text-gray-600 text-sm">Panier moyen</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAdminUsers() {
            const users = JSON.parse(localStorage.getItem('amigos_users') || '[]');
            const clients = users.filter(u => u.role === 'client');
            
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-black">Gestion des Utilisateurs</h2>
                    
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-700">Utilisateur</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Email</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Téléphone</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Inscription</th>
                                        <th class="px-6 py-4 text-left text-gray-700">Commandes</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-200">
                                    ${clients.map(user => {
                                        const userOrders = orders.filter(o => o.userId === user.id);
                                        return `
                                            <tr class="hover:bg-gray-50">
                                                <td class="px-6 py-4">
                                                    <div class="font-semibold text-black">${user.name}</div>
                                                </td>
                                                <td class="px-6 py-4 text-gray-600">${user.email}</td>
                                                <td class="px-6 py-4 text-gray-600">${user.phone || '-'}</td>
                                                <td class="px-6 py-4 text-gray-600">
                                                    ${new Date(user.joinedAt).toLocaleDateString('fr-FR')}
                                                </td>
                                                <td class="px-6 py-4">
                                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                                                        ${userOrders.length} commande(s)
                                                    </span>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // Page panier
        function renderCartPage() {
            if (cart.length === 0) {
                document.getElementById('app').innerHTML = `
                    <div class="py-20 text-center">
                        <i class="fas fa-shopping-cart text-6xl text-gray-300 mb-4"></i>
                        <h2 class="text-3xl font-bold mb-4 text-black">Votre panier est vide</h2>
                        <p class="text-gray-600 mb-8">Découvrez nos fragrances exclusives</p>
                        <button onclick="navigateTo('products')" class="btn-gold px-8 py-3 rounded-lg font-semibold">
                            Explorer la collection
                        </button>
                    </div>
                `;
                return;
            }

            const total = cart.reduce((sum, item) => sum + (getProductPrice(item.id) * item.quantity), 0);
            const savings = cart.reduce((sum, item) => {
                const product = products.find(p => p.id === item.id);
                return sum + (product.discount > 0 ? (product.price - product.salePrice) * item.quantity : 0);
            }, 0);

            document.getElementById('app').innerHTML = `
                <div class="py-12">
                    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h1 class="text-4xl font-bold mb-8 text-black">Mon Panier</h1>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Articles -->
                            <div class="lg:col-span-2 space-y-4">
                                ${cart.map(item => {
                                    const product = products.find(p => p.id === item.id);
                                    const price = getProductPrice(item.id);
                                    return `
                                        <div class="card-elegant p-6">
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center space-x-4">
                                                    <img src="${product.image}" alt="${product.name}" class="w-20 h-20 rounded object-cover">
                                                    <div>
                                                        <h3 class="font-semibold text-black">${product.name}</h3>
                                                        <p class="text-gold font-semibold">${price}€</p>
                                                        ${product.discount > 0 ? `
                                                            <p class="text-sm text-green-600">
                                                                Économie: ${((product.price - price) * item.quantity).toFixed(2)}€
                                                            </p>
                                                        ` : ''}
                                                    </div>
                                                </div>
                                                <div class="flex items-center space-x-4">
                                                    <div class="flex items-center space-x-2">
                                                        <button onclick="updateQuantity(${item.id}, ${item.quantity - 1})" 
                                                                class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 transition-colors">
                                                            -
                                                        </button>
                                                        <span class="w-8 text-center font-semibold">${item.quantity}</span>
                                                        <button onclick="updateQuantity(${item.id}, ${item.quantity + 1})" 
                                                                class="w-8 h-8 bg-gray-100 rounded hover:bg-gray-200 transition-colors">
                                                            +
                                                        </button>
                                                    </div>
                                                    <button onclick="removeFromCart(${item.id})" class="text-red-600 hover:text-red-800">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>

                            <!-- Résumé -->
                            <div class="space-y-4">
                                <div class="card-elegant p-6">
                                    <h3 class="text-xl font-semibold mb-4 text-black">Résumé de la commande</h3>
                                    
                                    <div class="space-y-2 mb-4">
                                        <div class="flex justify-between text-gray-600">
                                            <span>Sous-total</span>
                                            <span>${total.toFixed(2)}€</span>
                                        </div>
                                        ${savings > 0 ? `
                                            <div class="flex justify-between text-green-600">
                                                <span>Économies</span>
                                                <span>-${savings.toFixed(2)}€</span>
                                            </div>
                                        ` : ''}
                                        <div class="flex justify-between text-gray-600">
                                            <span>Livraison</span>
                                            <span>Gratuite</span>
                                        </div>
                                    </div>
                                    
                                    <div class="border-t pt-4">
                                        <div class="flex justify-between items-center text-xl font-semibold">
                                            <span>Total:</span>
                                            <span class="text-gold">${total.toFixed(2)}€</span>
                                        </div>
                                    </div>

                                    <button onclick="checkout()" class="btn-gold w-full py-3 rounded-lg font-semibold mt-4">
                                        Procéder au paiement
                                    </button>
                                </div>

                                <div class="card-elegant p-6">
                                    <h4 class="font-semibold mb-2 text-black">Avantages</h4>
                                    <ul class="text-sm text-gray-600 space-y-1">
                                        <li><i class="fas fa-shield-alt text-gold mr-2"></i>Paiement sécurisé</li>
                                        <li><i class="fas fa-truck text-gold mr-2"></i>Livraison gratuite</li>
                                        <li><i class="fas fa-undo text-gold mr-2"></i>Retours sous 30 jours</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Page profil utilisateur
        function renderProfilePage() {
            if (!currentUser) {
                showNotification('Veuillez vous connecter', 'error');
                navigateTo('login');
                return;
            }

            const userOrders = orders.filter(order => order.userId === currentUser.id);
            
            document.getElementById('app').innerHTML = `
                <div class="py-12">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h1 class="text-4xl font-bold mb-8 text-black">Mon Profil</h1>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Informations personnelles -->
                            <div class="lg:col-span-2 space-y-6">
                                <div class="card-elegant p-6">
                                    <h3 class="text-xl font-semibold mb-4 text-black">Informations Personnelles</h3>
                                    <div class="space-y-4">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-gray-700 mb-2">Nom complet</label>
                                                <input type="text" value="${currentUser.name}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" readonly>
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 mb-2">Email</label>
                                                <input type="email" value="${currentUser.email}" class="w-full px-4 py-2 border border-gray-300 rounded-lg" readonly>
                                            </div>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 mb-2">Téléphone</label>
                                            <input type="text" value="${currentUser.phone || ''}" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 mb-2">Adresse</label>
                                            <textarea class="w-full px-4 py-2 border border-gray-300 rounded-lg" rows="3">${currentUser.address || ''}</textarea>
                                        </div>
                                        <button class="btn-gold px-6 py-2 rounded-lg font-semibold">
                                            <i class="fas fa-save mr-2"></i>Enregistrer les modifications
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Statistiques -->
                            <div class="space-y-6">
                                <div class="card-elegant p-6 text-center">
                                    <div class="w-20 h-20 bg-gold rounded-full flex items-center justify-center mx-auto mb-4">
                                        <i class="fas fa-user text-2xl text-black"></i>
                                    </div>
                                    <h3 class="font-semibold text-black">${currentUser.name}</h3>
                                    <p class="text-gray-600 text-sm">Membre depuis ${new Date(currentUser.joinedAt).toLocaleDateString('fr-FR')}</p>
                                </div>

                                <div class="card-elegant p-6">
                                    <h4 class="font-semibold mb-4 text-black">Mes Statistiques</h4>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Commandes</span>
                                            <span class="font-semibold">${userOrders.length}</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Dernière commande</span>
                                            <span class="font-semibold">${userOrders.length > 0 ? new Date(userOrders[0].createdAt).toLocaleDateString('fr-FR') : '-'}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Page commandes utilisateur
        function renderOrdersPage() {
            if (!currentUser) {
                showNotification('Veuillez vous connecter', 'error');
                navigateTo('login');
                return;
            }

            const userOrders = orders.filter(order => order.userId === currentUser.id);
            
            document.getElementById('app').innerHTML = `
                <div class="py-12">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <h1 class="text-4xl font-bold mb-8 text-black">Mes Commandes</h1>
                        
                        ${userOrders.length === 0 ? `
                            <div class="text-center py-12">
                                <i class="fas fa-shopping-bag text-6xl text-gray-300 mb-4"></i>
                                <h3 class="text-2xl font-semibold text-gray-600">Aucune commande</h3>
                                <p class="text-gray-500 mt-2">Vous n'avez pas encore passé de commande</p>
                                <button onclick="navigateTo('products')" class="btn-gold px-6 py-3 rounded-lg mt-4">
                                    Découvrir nos produits
                                </button>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${userOrders.map(order => `
                                    <div class="card-elegant p-6">
                                        <div class="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 class="font-semibold text-black">Commande #${order.id}</h3>
                                                <p class="text-gray-600 text-sm">
                                                    Passée le ${new Date(order.createdAt).toLocaleDateString('fr-FR')}
                                                </p>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-xl font-bold text-gold">${order.total}€</div>
                                                <span class="status-badge status-${order.status}">
                                                    ${getOrderStatusText(order.status)}
                                                </span>
                                            </div>
                                        </div>
                                        
                                        <div class="border-t pt-4">
                                            <h4 class="font-semibold mb-2 text-black">Articles</h4>
                                            <div class="space-y-2">
                                                ${order.items.map(item => {
                                                    const product = products.find(p => p.id === item.productId);
                                                    return product ? `
                                                        <div class="flex justify-between items-center">
                                                            <div class="flex items-center space-x-3">
                                                                <img src="${product.image}" alt="${product.name}" class="w-10 h-10 rounded object-cover">
                                                                <span class="text-gray-700">${product.name}</span>
                                                            </div>
                                                            <div class="text-right">
                                                                <span class="text-gray-600">${item.quantity} x ${item.price}€</span>
                                                            </div>
                                                        </div>
                                                    ` : '';
                                                }).join('')}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Fonctions utilitaires produits
        function getProductPrice(product) {
            if (typeof product === 'number') {
                product = products.find(p => p.id === product);
            }
            return product.salePrice || product.price;
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock === 0) {
                showNotification('Produit indisponible', 'error');
                return;
            }

            const existing = cart.find(item => item.id === productId);
            if (existing) {
                if (existing.quantity >= product.stock) {
                    showNotification('Stock insuffisant', 'error');
                    return;
                }
                existing.quantity++;
            } else {
                cart.push({ id: productId, quantity: 1 });
            }
            
            localStorage.setItem('amigos_cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${product.name} ajouté au panier`, 'success');
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('amigos_cart', JSON.stringify(cart));
            updateCartCount();
            renderCartPage();
            showNotification('Produit retiré du panier', 'info');
        }

        function updateQuantity(productId, newQuantity) {
            const product = products.find(p => p.id === productId);
            if (newQuantity < 1) {
                removeFromCart(productId);
                return;
            }
            if (newQuantity > product.stock) {
                showNotification('Stock insuffisant', 'error');
                return;
            }
            
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                localStorage.setItem('amigos_cart', JSON.stringify(cart));
                updateCartCount();
                renderCartPage();
            }
        }

        function updateCartCount() {
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
            document.getElementById('cartCountMobile').textContent = count;
        }

        // Fonctions admin
        function switchAdminTab(tab) {
            currentAdminTab = tab;
            renderAdminPage();
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            // Remplir le formulaire
            document.getElementById('editProductId').value = product.id;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductPrice').value = product.price;
            document.getElementById('editProductDescription').value = product.description;
            document.getElementById('editProductCategory').value = product.category;
            document.getElementById('editProductStock').value = product.stock;
            document.getElementById('editProductImage').value = product.image;
            document.getElementById('editProductDiscount').value = product.discount || 0;
            document.getElementById('editProductFeatured').checked = product.featured || false;
            document.getElementById('editProductActive').checked = product.active !== false;

            // Calculer le prix promotionnel et mettre à jour l'aperçu
            calculateSalePrice();
            updateImagePreview();

            document.getElementById('editProductTitle').textContent = `Modifier ${product.name}`;
            showModal('editProductModal');
        }

        function calculateSalePrice() {
            const price = parseFloat(document.getElementById('editProductPrice').value) || 0;
            const discount = parseInt(document.getElementById('editProductDiscount').value) || 0;
            const salePrice = price * (1 - discount / 100);
            document.getElementById('editProductSalePrice').value = discount > 0 ? salePrice.toFixed(2) : '';
        }

        function updateImagePreview() {
            const imageUrl = document.getElementById('editProductImage')?.value || document.getElementById('productImage')?.value;
            const preview = document.getElementById('editProductImagePreview');
            
            if (preview && imageUrl) {
                preview.src = imageUrl;
                preview.classList.remove('hidden');
            }
        }

        function updateProduct(event) {
            event.preventDefault();
            const productId = parseInt(document.getElementById('editProductId').value);
            const product = products.find(p => p.id === productId);

            if (product) {
                product.name = document.getElementById('editProductName').value;
                product.price = parseFloat(document.getElementById('editProductPrice').value);
                product.description = document.getElementById('editProductDescription').value;
                product.category = document.getElementById('editProductCategory').value;
                product.stock = parseInt(document.getElementById('editProductStock').value);
                product.image = document.getElementById('editProductImage').value;
                product.discount = parseInt(document.getElementById('editProductDiscount').value) || 0;
                product.featured = document.getElementById('editProductFeatured').checked;
                product.active = document.getElementById('editProductActive').checked;
                
                // Calculer le prix promotionnel
                if (product.discount > 0) {
                    product.salePrice = parseFloat((product.price * (1 - product.discount / 100)).toFixed(2));
                } else {
                    product.salePrice = null;
                }

                localStorage.setItem('amigos_products', JSON.stringify(products));
                closeModal('editProductModal');
                renderAdminPage();
                showNotification('Produit modifié avec succès', 'success');
            }
        }

        function toggleProductStatus(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.active = !product.active;
                localStorage.setItem('amigos_products', JSON.stringify(products));
                renderAdminPage();
                showNotification(`Produit ${product.active ? 'activé' : 'désactivé'}`, 'success');
            }
        }

        function deleteProduct(productId) {
            if (confirm('Êtes-vous sûr de vouloir supprimer définitivement ce produit ?')) {
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('amigos_products', JSON.stringify(products));
                renderAdminPage();
                showNotification('Produit supprimé', 'success');
            }
        }

        function addNewProduct(event) {
            event.preventDefault();
            
            const newProduct = {
                id: Math.max(0, ...products.map(p => p.id)) + 1,
                name: document.getElementById('productName').value,
                price: parseFloat(document.getElementById('productPrice').value),
                description: document.getElementById('productDescription').value,
                category: document.getElementById('productCategory').value,
                stock: parseInt(document.getElementById('productStock').value),
                image: document.getElementById('productImage').value,
                featured: document.getElementById('productFeatured').checked,
                discount: 0,
                salePrice: null,
                active: true,
                createdAt: new Date().toISOString()
            };

            products.push(newProduct);
            localStorage.setItem('amigos_products', JSON.stringify(products));
            closeModal('addProductModal');
            renderAdminPage();
            showNotification('Nouveau produit créé avec succès', 'success');
        }

        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            const user = JSON.parse(localStorage.getItem('amigos_users')).find(u => u.id === order.userId);
            
            if (order && user) {
                document.getElementById('orderDetailsContent').innerHTML = `
                    <div class="space-y-6">
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold text-black mb-2">Informations Client</h4>
                                <div class="space-y-1 text-gray-600">
                                    <p><strong>Nom:</strong> ${user.name}</p>
                                    <p><strong>Email:</strong> ${user.email}</p>
                                    <p><strong>Téléphone:</strong> ${user.phone || 'Non renseigné'}</p>
                                    <p><strong>Adresse:</strong> ${order.shippingAddress}</p>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold text-black mb-2">Détails Commande</h4>
                                <div class="space-y-1 text-gray-600">
                                    <p><strong>N° Commande:</strong> #${order.id}</p>
                                    <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleDateString('fr-FR')}</p>
                                    <p><strong>Statut:</strong> <span class="status-badge status-${order.status}">${getOrderStatusText(order.status)}</span></p>
                                    <p><strong>Total:</strong> <span class="text-gold font-semibold">${order.total}€</span></p>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-black mb-4">Articles commandés</h4>
                            <div class="space-y-3">
                                ${order.items.map(item => {
                                    const product = products.find(p => p.id === item.productId);
                                    return product ? `
                                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                            <div class="flex items-center space-x-3">
                                                <img src="${product.image}" alt="${product.name}" class="w-12 h-12 rounded object-cover">
                                                <div>
                                                    <div class="font-semibold">${product.name}</div>
                                                    <div class="text-sm text-gray-600">${product.category}</div>
                                                </div>
                                            </div>
                                            <div class="text-right">
                                                <div class="font-semibold">${item.quantity} x ${item.price}€</div>
                                                <div class="text-gold font-semibold">${(item.quantity * item.price).toFixed(2)}€</div>
                                            </div>
                                        </div>
                                    ` : '';
                                }).join('')}
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4 pt-4 border-t">
                            <button onclick="closeModal('orderDetailsModal')" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                                Fermer
                            </button>
                        </div>
                    </div>
                `;
                showModal('orderDetailsModal');
            }
        }

        // Fonctions analytics
        function calculateMonthlyRevenue() {
            const months = [];
            const now = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const monthKey = date.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
                const monthOrders = orders.filter(order => {
                    const orderDate = new Date(order.createdAt);
                    return orderDate.getMonth() === date.getMonth() && orderDate.getFullYear() === date.getFullYear();
                });
                const revenue = monthOrders.reduce((sum, order) => sum + order.total, 0);
                
                months.push({
                    month: monthKey.charAt(0).toUpperCase() + monthKey.slice(1),
                    revenue: revenue.toFixed(2)
                });
            }
            
            return months;
        }

        function getTopProducts() {
            const productSales = {};
            
            orders.forEach(order => {
                order.items.forEach(item => {
                    if (!productSales[item.productId]) {
                        productSales[item.productId] = 0;
                    }
                    productSales[item.productId] += item.quantity;
                });
            });
            
            return Object.entries(productSales)
                .map(([productId, sales]) => {
                    const product = products.find(p => p.id === parseInt(productId));
                    return {
                        id: parseInt(productId),
                        name: product?.name || 'Produit inconnu',
                        sales: sales
                    };
                })
                .sort((a, b) => b.sales - a.sales);
        }

        function calculateTotalSales() {
            return orders.reduce((total, order) => {
                return total + order.items.reduce((sum, item) => sum + item.quantity, 0);
            }, 0);
        }

        function calculateAverageOrderValue() {
            return orders.length > 0 ? (orders.reduce((sum, order) => sum + order.total, 0) / orders.length).toFixed(2) : '0.00';
        }

        function getOrderStatusText(status) {
            const statusMap = {
                'pending': 'En attente',
                'confirmed': 'Confirmée',
                'shipped': 'Expédiée',
                'delivered': 'Livrée',
                'cancelled': 'Annulée'
            };
            return statusMap[status] || status;
        }

        // Fonctions authentification
        function handleAuthClick() {
            if (currentUser) {
                const userMenu = document.getElementById('userMenu');
                userMenu.classList.toggle('hidden');
            } else {
                navigateTo('login');
            }
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const users = JSON.parse(localStorage.getItem('amigos_users') || '[]');

            // Afficher le loading
            document.getElementById('loginText').classList.add('hidden');
            document.getElementById('loginSpinner').classList.remove('hidden');

            // Simuler un délai de connexion
            setTimeout(() => {
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('amigos_currentUser', JSON.stringify(user));
                    updateAuthUI();
                    closeModal('loginModal');
                    showNotification(`Bienvenue ${user.name}`, 'success');
                    
                    if (user.role === 'admin') {
                        navigateTo('admin');
                    } else {
                        navigateTo('home');
                    }
                } else {
                    showNotification('Email ou mot de passe incorrect', 'error');
                }
                
                // Cacher le loading
                document.getElementById('loginText').classList.remove('hidden');
                document.getElementById('loginSpinner').classList.add('hidden');
            }, 1000);
        }

        function updateAuthUI() {
            const authBtn = document.getElementById('authBtn');
            const adminBtn = document.getElementById('adminBtn');
            const userMenu = document.getElementById('userMenu');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');

            if (currentUser) {
                authBtn.innerHTML = `<i class="fas fa-user-check text-xl"></i>`;
                adminBtn.classList.toggle('hidden', currentUser.role !== 'admin');
                
                if (userName) userName.textContent = currentUser.name;
                if (userEmail) userEmail.textContent = currentUser.email;
            } else {
                authBtn.innerHTML = `<i class="fas fa-user text-xl"></i>`;
                adminBtn.classList.add('hidden');
                userMenu?.classList.add('hidden');
            }
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('amigos_currentUser');
            updateAuthUI();
            navigateTo('home');
            showNotification('Déconnexion réussie', 'success');
            document.getElementById('userMenu').classList.add('hidden');
        }

        // Fonctions utilitaires
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function showNotification(message, type = 'info') {
            // Supprimer les notifications existantes
            document.querySelectorAll('.notification').forEach(notif => notif.remove());

            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${getNotificationIcon(type)} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 4000);
        }

        function getNotificationIcon(type) {
            const icons = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };
            return icons[type] || 'info-circle';
        }

        function filterProducts() {
            const category = document.getElementById('categoryFilter').value;
            const productsGrid = document.getElementById('productsGrid');
            const productCards = productsGrid.getElementsByClassName('card-elegant');
            
            Array.from(productCards).forEach(card => {
                const productCategory = card.getAttribute('data-category');
                if (category === 'all' || productCategory === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        function sortProducts() {
            const sortBy = document.getElementById('sortFilter').value;
            let sortedProducts = [...products.filter(p => p.active)];
            
            switch(sortBy) {
                case 'price-asc':
                    sortedProducts.sort((a, b) => getProductPrice(a) - getProductPrice(b));
                    break;
                case 'price-desc':
                    sortedProducts.sort((a, b) => getProductPrice(b) - getProductPrice(a));
                    break;
                case 'newest':
                    sortedProducts.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                default:
                    sortedProducts.sort((a, b) => a.name.localeCompare(b.name));
            }
            
            // Réorganiser l'affichage
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = sortedProducts.map(product => `
                <div class="card-elegant rounded-2xl p-6" data-category="${product.category}">
                    <div class="h-64 overflow-hidden rounded-lg mb-4 relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                        ${product.discount > 0 ? `
                            <div class="absolute top-4 right-4 promo-badge px-3 py-1 rounded-full text-sm font-bold">
                                -${product.discount}%
                            </div>
                        ` : ''}
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-black">${product.name}</h3>
                    <p class="text-gray-600 text-sm mb-4">${product.description}</p>
                    <div class="flex justify-between items-center">
                        ${product.discount > 0 ? `
                            <div>
                                <span class="text-lg text-gray-500 line-through">${product.price}€</span>
                                <span class="text-2xl font-bold text-gold ml-2">${product.salePrice}€</span>
                            </div>
                        ` : `
                            <span class="text-2xl font-bold text-gold">${product.price}€</span>
                        `}
                        <button onclick="addToCart(${product.id})" class="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-800">
                            Ajouter
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function checkout() {
            if (cart.length === 0) {
                showNotification('Votre panier est vide', 'error');
                return;
            }

            // Vérifier le stock
            for (const item of cart) {
                const product = products.find(p => p.id === item.id);
                if (!product || product.stock < item.quantity) {
                    showNotification(`Stock insuffisant pour ${product?.name || 'un produit'}`, 'error');
                    return;
                }
            }

            // Créer la commande
            const newOrder = {
                id: Math.max(0, ...orders.map(o => o.id)) + 1,
                userId: currentUser?.id || 0,
                items: cart.map(item => {
                    const product = products.find(p => p.id === item.id);
                    return {
                        productId: item.id,
                        quantity: item.quantity,
                        price: getProductPrice(product)
                    };
                }),
                total: cart.reduce((sum, item) => sum + (getProductPrice(item.id) * item.quantity), 0),
                status: 'confirmed',
                shippingAddress: currentUser?.address || 'Non spécifiée',
                createdAt: new Date().toISOString()
            };

            // Mettre à jour le stock
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                }
            });

            // Sauvegarder
            orders.push(newOrder);
            localStorage.setItem('amigos_orders', JSON.stringify(orders));
            localStorage.setItem('amigos_products', JSON.stringify(products));

            // Vider le panier
            cart = [];
            localStorage.setItem('amigos_cart', JSON.stringify(cart));
            updateCartCount();

            showNotification('Commande passée avec succès !', 'success');
            navigateTo('home');
        }

        // Fermer les menus au clic extérieur
        document.addEventListener('click', (e) => {
            if (!e.target.closest('#authBtn') && !e.target.closest('#userMenu')) {
                document.getElementById('userMenu')?.classList.add('hidden');
            }
        });

        // Initialiser l'application
        initializeApp();
    </script>
</body>
</html>
